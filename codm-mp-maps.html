<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>COD:M — Map Layouts</title>

<style>
  :root{
    --bg:#0d1014; --panel:#1b2130; --panel2:#121724;
    --ink:#eef3fb; --muted:#b6c0ce; --line:#343c4b;
    --brand:#ffe93b; --accent:#7fd2ff;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif}

  /* Header */
  header{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,#131823 0%,#0d1014 100%);border-bottom:2px solid var(--brand)}
  .head{max-width:1200px;margin:0 auto;padding:10px 14px;display:flex;align-items:center;gap:12px}
  .logo{height:28px;aspect-ratio:auto;display:block}
  h1{margin:0;font-size:1.05rem;letter-spacing:.2px}
  .spacer{flex:1}
  .btn{background:var(--brand);color:#0b0f14;border:0;border-radius:10px;padding:8px 12px;font-weight:800;cursor:pointer}
  .btn.secondary{background:#171d2a;color:#dbe3f0;border:1px solid var(--line)}
  a.btn{display:inline-flex;align-items:center;gap:8px;text-decoration:none}

  /* Layout */
  .shell{max-width:1200px;margin:16px auto;padding:0 12px}
  
  /* Mobile-first: viewer on top, maps below */
  .grid{
    display:grid;
    gap:14px;
    grid-template-columns:1fr;
    grid-template-areas:
      "viewer"
      "maps";
  }
  
  /* ≥ 768px: maps left, viewer right */
  @media (min-width:768px){
    .grid{
      grid-template-columns:360px 1fr;
      grid-template-areas:"maps viewer";
    }
  }
  
  /* Areas */
  .panel{ grid-area: maps; }
  .viewer{ grid-area: viewer; }

  /* Panels */
  .panel{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:12px}
  .panel h2{margin:0 0 8px 0;font-size:1rem}

  /* Search */
  .search{display:flex;gap:8px;margin-bottom:10px}
  .search input{flex:1;background:#0f1421;color:var(--ink);border:1px solid var(--line);border-radius:10px;padding:8px 10px}

  /* Buttons */
  .mode-section{margin-bottom:10px}
  .mode-title{margin:6px 0 8px 0;font-weight:800;color:#fff}

  /* Map list */
  .map-list{
    display:grid;
    grid-template-columns: 1fr;
    gap:8px;
  }
  @media (max-width: 1000px){
    .map-list{ grid-template-columns: repeat(3, minmax(80px, 1fr)); }
  }
  @media (max-width: 600px){
    .map-list{ grid-template-columns: repeat(2, minmax(120px, 1fr)); }
  }

  .map-btn{
    background:#0f1524;border:1px solid var(--line);color:#dfe7f5;border-radius:12px;
    padding:10px 10px; text-align:center; cursor:pointer; user-select:none;
    transition:transform .05s ease, border-color .2s ease, background .2s ease;
  }
  .map-btn:hover{transform:translateY(-1px);border-color:#4b9bd6}
  .map-btn.active{background:#152036;border-color:var(--accent);box-shadow:0 0 0 2px #152036, 0 0 0 4px rgba(127,210,255,.25) inset}

  /* Viewer */
  .viewer{background:var(--panel2);border:1px solid var(--line);border-radius:14px;padding:10px}
  .viewer-head{display:flex;align-items:center;gap:10px;margin:0 0 10px 0}
  .viewer-title{font-weight:800}
  .viewer-tools{margin-left:auto;display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .viewer-tools .btn{padding:6px 10px}
  .viewer-tools .meter{min-width:52px;text-align:center;font-variant-numeric:tabular-nums}

  /* Tool toggle (Pan / Zoom) */
  .seg{display:inline-flex;border:1px solid var(--line);border-radius:10px;overflow:hidden}
  .seg button{
    background:#161b28;color:#e5ecfa;border:0;padding:6px 10px;cursor:pointer;
  }
  .seg button+button{border-left:1px solid var(--line)}
  .seg button[aria-pressed="true"]{background:#23304a;color:#fff;box-shadow:inset 0 0 0 1px #3e4b65}

  .img-wrap{
    width:100%;height:72vh;min-height:360px;background:#0a0e18;border:1px solid var(--line);
    border-radius:12px;display:flex;align-items:flex-start;justify-content:center; /* TOP aligned, horizontally centered */
    overflow:auto;
  }
  /* cursors switch per mode */
  .img-wrap.mode-pan{cursor:grab}
  .img-wrap.mode-pan.grabbing{cursor:grabbing}
  .img-wrap.mode-zoom{cursor:zoom-in}
  .img-wrap.mode-zoom.alt{cursor:zoom-out}

  .zoom-stage{display:inline-block;width:auto;height:auto;}
  .zoom-stage img{width:100%;height:100%;object-fit:contain;display:block}

  .muted{color:var(--muted)}
</style>
</head>
<body>
<header>
  <div class="head">
    <img src="https://i.imgur.com/K0TTjUC.png" alt="COD:M logo" class="logo" />
    <h1>COD:M — Map Layouts</h1>
    <div class="spacer"></div>
    <a class="btn secondary" href="index.html" title="Back to Home">⟵ Home</a>
  </div>
</header>

<div class="shell">
  <div class="grid">
    <!-- Left: maps grouped by mode (moves below on small screens) -->
    <section class="panel">
      <h2>Maps</h2>
      <div class="search">
        <input id="q" type="search" placeholder="Filter maps…" />
        <button class="btn secondary" id="clearBtn">Clear</button>
      </div>

      <div id="groups"></div>
      <p class="muted" id="countNote" style="margin-top:8px"></p>
    </section>

    <!-- Right: viewer -->
    <section class="viewer">
      <div class="viewer-head">
        <div class="viewer-title" id="title">Select a map</div>
        <div class="viewer-tools">
          <!-- Pan / Zoom toggle -->
          <div class="seg" role="group" aria-label="Tool">
            <button id="toolPan"  aria-pressed="true"  title="Pan tool (P)">Pan</button>
            <button id="toolZoom" aria-pressed="false" title="Zoom tool (Z). Alt/Right-click = zoom out">Zoom</button>
          </div>

          <!-- Zoom controls -->
          <button class="btn secondary" id="zoomOut" title="Zoom out (Ctrl/⌘ -)">−</button>
          <button class="btn secondary meter" id="zoomMeter" title="Reset zoom (Ctrl/⌘ 0)">100%</button>
          <button class="btn secondary" id="zoomIn" title="Zoom in (Ctrl/⌘ +)">+</button>

          <a id="openLink" class="btn secondary" href="#" target="_blank" rel="noopener">Open</a>
          <a id="downloadLink" class="btn" href="#" download>Download</a>
        </div>
      </div>
      <div class="img-wrap mode-pan" id="wrap">
        <div id="stage" class="zoom-stage">
          <img id="img" alt="Map layout preview" />
        </div>
      </div>
      <p class="muted" style="margin-top:10px">
        Default view shows the map from <b>top</b>. Use the <b>Pan</b> or <b>Zoom</b> tools:
        <br>• <b>Pan</b>: drag to move. &nbsp;• <b>Zoom</b>: click to zoom in, <b>Alt</b>/<b>Right-click</b> to zoom out. &nbsp;• Ctrl/⌘ + scroll also zooms.
      </p>
    </section>
  </div>
</div>

<script>
  /* === Source images === */
  const MAPS = [
    {name:'Coastal', url:'https://i.imgur.com/2JRlrj5.png'},
    {name:'Crossfire', url:'https://i.imgur.com/YYor9iP.png'},
    {name:'Firing Range', url:'https://i.imgur.com/QWJg4Ai.png'},
    {name:'Kurohana Metropolis', url:'https://i.imgur.com/eeYVgRp.png'},
    {name:'Raid', url:'https://i.imgur.com/cGh1ku0.png'},
    {name:'Standoff', url:'https://i.imgur.com/8gaEr2j.png'},
    {name:'Tunisia', url:'https://i.imgur.com/D23jrcJ.png'},
    {name:'Apocalypse', url:'https://i.imgur.com/djfhXIE.png'},
    {name:'Hacienda', url:'https://i.imgur.com/aOWvPKU.png'},
    {name:'Slums', url:'https://i.imgur.com/9y2NzWw.png'},
    {name:'Summit', url:'https://i.imgur.com/yevs7pE.png'},
    {name:'Takeoff', url:'https://i.imgur.com/OofTHfO.png'},
    {name:'Combine', url:'https://i.imgur.com/DtBhN36.png'}
  ];

  /* === Grouping by mode (buttons appear under each) === */
  const MAPS_BY_MODE = {
    'Hardpoint':        ['Summit','Hacienda','Apocalypse','Slums','Combine'],
    'Search & Destroy': ['Tunisia','Firing Range','Kurohana Metropolis','Standoff','Coastal'],
    'Control':          ['Raid','Takeoff','Crossfire']
  };
  const MODE_ORDER = ['Hardpoint','Search & Destroy','Control'];

  const groupsEl   = document.getElementById('groups');
  const titleEl    = document.getElementById('title');
  const wrap       = document.getElementById('wrap');
  const stage      = document.getElementById('stage');
  const imgEl      = document.getElementById('img');

  const openLink   = document.getElementById('openLink');
  const dlLink     = document.getElementById('downloadLink');
  const q          = document.getElementById('q');
  const clearBtn   = document.getElementById('clearBtn');
  const countNote  = document.getElementById('countNote');

  const zoomOutBtn = document.getElementById('zoomOut');
  const zoomInBtn  = document.getElementById('zoomIn');
  const zoomMeter  = document.getElementById('zoomMeter');

  const toolPanBtn  = document.getElementById('toolPan');
  const toolZoomBtn = document.getElementById('toolZoom');

  let flatFiltered = []; // flattened ordered list of visible map names
  let activeName = '';   // currently selected map name

  // Tool mode: 'pan' | 'zoom'
  let toolMode = 'pan';

  // Zoom state
  let baseW = 0, baseH = 0;  // fitted size at 100% (default placement)
  let zoom = 1;
  const Z_MIN = 1;
  const Z_MAX = 6;
  const Z_STEP = 0.2;

  function clamp(v, a, b){ return Math.min(Math.max(v, a), b); }

  function setTool(mode){
    toolMode = mode;
    toolPanBtn.setAttribute('aria-pressed', mode==='pan');
    toolZoomBtn.setAttribute('aria-pressed', mode==='zoom');
    wrap.classList.toggle('mode-pan',  mode==='pan');
    wrap.classList.toggle('mode-zoom', mode==='zoom');
  }

  // Cursor update for zoom-out hint when Alt is held
  document.addEventListener('keydown', (e)=>{
    if (toolMode==='zoom' && (e.key==='Alt')) wrap.classList.add('alt');
  });
  document.addEventListener('keyup', (e)=>{
    if (e.key==='Alt') wrap.classList.remove('alt');
  });

  function findGlobalMap(name){
    return MAPS.find(m => m.name.toLowerCase() === name.toLowerCase());
  }

  function renderGroups(){
    const term = (q.value||'').trim().toLowerCase();
    flatFiltered = [];
    groupsEl.innerHTML = '';

    MODE_ORDER.forEach(mode=>{
      const names = MAPS_BY_MODE[mode].filter(n => n.toLowerCase().includes(term));
      if (!names.length) return;

      const sec = document.createElement('div');
      sec.className = 'mode-section';

      const h = document.createElement('div');
      h.className = 'mode-title';
      h.textContent = mode;
      sec.appendChild(h);

      const list = document.createElement('div');
      list.className = 'map-list';

      names.forEach(n=>{
        const m = findGlobalMap(n);
        if (!m) return;
        flatFiltered.push(m.name);

        const b = document.createElement('button');
        b.className = 'map-btn';
        b.textContent = m.name;
        b.dataset.name = m.name;
        b.onclick = () => selectName(m.name);
        list.appendChild(b);
      });

      sec.appendChild(list);
      groupsEl.appendChild(sec);
    });

    const total = Object.values(MAPS_BY_MODE).flat().length;
    countNote.textContent = `${flatFiltered.length} of ${total} maps`;

    applyActiveStyle();

    if (flatFiltered.length && !flatFiltered.includes(activeName)){
      selectName(flatFiltered[0]);
    }
  }

  function selectName(name){
    const m = findGlobalMap(name);
    if (!m) return;
    activeName = m.name;
    titleEl.textContent = m.name;
    imgEl.src = m.url;
    imgEl.alt = `${m.name} map layout`;
    if (openLink) openLink.href = m.url;
    dlLink.href = m.url;
    applyActiveStyle();
  }

  function applyActiveStyle(){
    groupsEl.querySelectorAll('.map-btn').forEach(btn=>{
      btn.classList.toggle('active', btn.dataset.name === activeName);
    });
  }

  /* === Zoom mechanics === */
  function setZoom(nextZoom, anchor = 'center', clientX = null, clientY = null){
    const prev = zoom;
    zoom = clamp(nextZoom, Z_MIN, Z_MAX);
    if (!baseW || !baseH) return;

    // anchor (in viewer coords)
    const wrapRect = wrap.getBoundingClientRect();
    const ax = (anchor === 'pointer' && clientX != null) ? (clientX - wrapRect.left) : wrap.clientWidth/2;
    const ay = (anchor === 'pointer' && clientY != null) ? (clientY - wrapRect.top)  : wrap.clientHeight/2;

    const contentX = wrap.scrollLeft + ax;
    const contentY = wrap.scrollTop  + ay;

    // resize the stage so scrollbars reflect size
    stage.style.width  = (baseW * zoom) + 'px';
    stage.style.height = (baseH * zoom) + 'px';

    // keep same anchor under cursor/center
    const scale = zoom / prev;
    wrap.scrollLeft = (contentX * scale) - ax;
    wrap.scrollTop  = (contentY * scale) - ay;

    zoomMeter.textContent = Math.round(zoom * 100) + '%';
  }

  function resetZoomToFit(){
    // allow natural fit first
    stage.style.width = stage.style.height = '';
    imgEl.style.width = imgEl.style.height = '';
    imgEl.style.maxWidth = '100%';
    imgEl.style.maxHeight = '100%';

    requestAnimationFrame(()=>{
      const r = imgEl.getBoundingClientRect();
      baseW = r.width;
      baseH = r.height;

      stage.style.width  = baseW + 'px';
      stage.style.height = baseH + 'px';
      imgEl.style.width  = '100%';
      imgEl.style.height = '100%';

      zoom = 1;
      zoomMeter.textContent = '100%';

      // Default view: TOP aligned, horizontally centered
      wrap.scrollTop  = 0;
      wrap.scrollLeft = Math.max(0, (stage.scrollWidth - wrap.clientWidth)/2);
    });
  }

  // image load => compute base fit size and reset zoom
  imgEl.addEventListener('load', resetZoomToFit);

  // Wheel zoom (Ctrl/⌘ + wheel)
  wrap.addEventListener('wheel', (e)=>{
    if (e.ctrlKey || e.metaKey){
      e.preventDefault();
      const k = e.deltaY < 0 ? 1.1 : (1/1.1);
      setZoom(zoom * k, 'pointer', e.clientX, e.clientY);
    }
  }, {passive:false});

  // ===== Pan (when tool = pan)
  (function enablePanning(){
    let dragging = false, sx=0, sy=0, sl=0, st=0;
    wrap.addEventListener('mousedown', (e)=>{
      if (toolMode!=='pan' || e.button!==0) return;
      dragging = true;
      wrap.classList.add('grabbing');
      sx = e.clientX; sy = e.clientY; sl = wrap.scrollLeft; st = wrap.scrollTop;
      e.preventDefault();
    });
    window.addEventListener('mousemove', (e)=>{
      if (!dragging) return;
      wrap.scrollLeft = sl - (e.clientX - sx);
      wrap.scrollTop  = st - (e.clientY - sy);
    });
    window.addEventListener('mouseup', ()=>{
      dragging = false;
      wrap.classList.remove('grabbing');
    });
  })();

  // ===== Zoom clicks (when tool = zoom)
  // Left-click / tap: zoom in at pointer. Right-click or Alt: zoom out.
  wrap.addEventListener('mousedown', (e)=>{
    if (toolMode!=='zoom') return;
    // ignore middle button
    if (e.button===1) return;

    const isZoomOut = (e.button===2) || e.altKey;
    e.preventDefault();
    setZoom(zoom * (isZoomOut ? 1/1.25 : 1.25), 'pointer', e.clientX, e.clientY);
  });

  // Double-click to zoom in; Shift+double-click to zoom out
  wrap.addEventListener('dblclick', (e)=>{
    if (toolMode!=='zoom') return;
    e.preventDefault();
    const isOut = e.shiftKey || e.altKey;
    setZoom(zoom * (isOut ? 1/1.5 : 1.5), 'pointer', e.clientX, e.clientY);
  });

  // Use right-click for zoom-out in Zoom mode — prevent context menu
  wrap.addEventListener('contextmenu', (e)=>{
    if (toolMode==='zoom') e.preventDefault();
  });

  // Zoom buttons
  zoomInBtn.addEventListener('click', ()=> setZoom(zoom + Z_STEP, 'center'));
  zoomOutBtn.addEventListener('click', ()=> setZoom(zoom - Z_STEP, 'center'));
  zoomMeter.addEventListener('click', resetZoomToFit);

  // Keyboard shortcuts
  window.addEventListener('keydown', (e)=>{
    // Tool quick toggles
    if (!e.ctrlKey && !e.metaKey){
      if (e.key==='p' || e.key==='P'){ setTool('pan'); }
      if (e.key==='z' || e.key==='Z'){ setTool('zoom'); }
    }
    // Zooming
    if (e.ctrlKey || e.metaKey){
      if (e.key === '+' || e.key === '=' ){ e.preventDefault(); setZoom(zoom + Z_STEP, 'center'); }
      if (e.key === '-' ){ e.preventDefault(); setZoom(zoom - Z_STEP, 'center'); }
      if (e.key === '0' ){ e.preventDefault(); resetZoomToFit(); }
    }
  });

  // Keyboard navigation across the flattened filtered order
  window.addEventListener('keydown', (e)=>{
    if (!flatFiltered.length) return;
    if (e.ctrlKey || e.metaKey) return; // let zoom shortcuts handle above
    const idx = flatFiltered.indexOf(activeName);
    if (['ArrowDown','ArrowRight'].includes(e.key)){
      e.preventDefault();
      const next = (idx + 1 + flatFiltered.length) % flatFiltered.length;
      selectName(flatFiltered[next]);
    } else if (['ArrowUp','ArrowLeft'].includes(e.key)){
      e.preventDefault();
      const prev = (idx - 1 + flatFiltered.length) % flatFiltered.length;
      selectName(flatFiltered[prev]);
    }
  });

  // Tool toggle wiring
  toolPanBtn.addEventListener('click', ()=> setTool('pan'));
  toolZoomBtn.addEventListener('click', ()=> setTool('zoom'));

  // Preload images
  MAPS.forEach(m => { const im = new Image(); im.src = m.url; });

  // Search wiring
  q.addEventListener('input', renderGroups);
  clearBtn.addEventListener('click', ()=>{ q.value=''; renderGroups(); });

  // Initial render
  renderGroups();
  if (flatFiltered.length) selectName(flatFiltered[0]);
  setTool('pan'); // default tool
</script>
</body>
</html>
