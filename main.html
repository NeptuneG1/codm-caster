<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>COD:M — BR Caster Reference</title>
<meta name="theme-color" content="#0d1014"/>

<style>
  /* CODM palette */
  :root{
    --bg:#0d1014;
    --panel:#292d42;
    --panel2:#1e2432;
    --ink:#f3f6fa;
    --muted:#b8c0cc;
    --brand:#ffe93b;
    --brandText:#0b0d0e;
    --brand2:#ffffff;
    --line:#4c525d;
    --chip:#213830;
    --good:#62e887; --bad:#ff6b6b; --warn:#ffe93b;
  }

  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif}
  a{color:var(--brand);text-decoration:none}
  a:hover{text-decoration:underline}

  header{position:sticky;top:0;z-index:20;background:linear-gradient(180deg,#141a23 0%,#0d1014 100%);border-bottom:2px solid var(--brand)}
  .head{display:flex;align-items:center;gap:12px;max-width:1200px;margin:0 auto;padding:10px 14px;flex-wrap:wrap}
  .logo{width:36px;height:36px;border-radius:8px;object-fit:contain;flex:0 0 auto}
  h1{margin:0;font-size:1.05rem;letter-spacing:.3px;color:var(--brand)}
  .head .bar{margin-left:auto;display:flex;gap:8px;align-items:center;min-width:260px}
  /* Tabs inside header */
  .head .tabs{margin:0;gap:6px;flex-wrap:nowrap;overflow:auto;padding-bottom:2px}
  .tabs{display:flex;gap:8px;flex-wrap:wrap}
  .tab{background:var(--panel2);border:1px solid var(--line);color:var(--ink);padding:6px 10px;border-radius:10px;cursor:pointer;white-space:nowrap}
  .tab[aria-current="page"]{background:var(--brand);color:var(--brandText);border-color:var(--brand);font-weight:900}

  .shell{max-width:1200px;margin:14px auto;padding:0 12px}

  /* filter bar */
  .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .chip{background:var(--chip);border:1px solid var(--line);color:#d2efe1;border-radius:999px;padding:6px 10px}
  .controls input,.controls select{background:#151b26;color:var(--ink);border:1px solid var(--line);border-radius:8px;padding:8px 10px}
  .muted{color:var(--muted)}
  .hidden{display:none}

  .block{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:12px;margin-bottom:12px;box-shadow:0 0 0 1px rgba(0,0,0,.2) inset}
  .block h2{margin:0 0 6px 0;color:var(--brand2);font-size:1rem}
  .group-head{display:flex;align-items:baseline;gap:10px;flex-wrap:wrap}

  /* ===== Classes page cards ===== */
  .grid{display:grid;grid-template-columns:1fr;gap:12px}
  @media(min-width:800px){ .grid{grid-template-columns:1fr 1fr} }
  @media(min-width:1080px){ .grid{grid-template-columns:1fr 1fr 1fr} }
  .class-card{background:var(--panel2);border:1px solid var(--line);border-radius:12px;overflow:hidden;display:flex;flex-direction:column}
  .class-card img{width:100%;aspect-ratio:16/9;object-fit:cover;background:#000}
  .class-info{padding:10px;display:flex;flex-direction:column;gap:6px}
  .title-row{display:flex;align-items:center;gap:8px}
  .title-row h3{margin:0;font-size:1rem}
  .pill{display:inline-block;padding:2px 8px;border-radius:999px;background:#101621;border:1px solid var(--line);color:#e7ecf3;font-size:.72rem}
  .kv b{color:#ffffff}

  /* ===== Two-column layout pages ===== */
  .layout{display:grid;grid-template-columns:1fr;gap:12px}
  @media(min-width:900px){ .layout{grid-template-columns:minmax(260px,340px) 1fr} }

  /* left column mini list */
  .side{background:var(--panel2);border:1px solid var(--line);border-radius:12px;padding:10px;display:flex;flex-direction:column;gap:10px}
  .side .controls{margin-bottom:4px}
  .mini-meta{font-size:.85rem;color:var(--muted)}
  .mini-list{display:grid;grid-template-columns:1fr;gap:8px;overflow:auto;max-height:calc(100dvh - 220px)}
  @media(min-width:900px){
    .mini-list{position:sticky;top:88px;max-height:calc(100dvh - 110px)}
  }
  .mini-card{display:flex;align-items:flex-start;gap:10px;padding:8px;border-radius:12px;background:#141b27;border:1px solid var(--line)}
  .mini-thumb{width:84px;height:52px;border-radius:8px;object-fit:cover;background:#000;flex:0 0 auto}
  .mini-txt{display:flex;flex-direction:column;gap:2px;min-width:0}
  .mini-name{font-size:.9rem;font-weight:800;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .mini-pill{font-size:.66rem;opacity:.9;border:1px solid var(--line);border-radius:999px;padding:1px 6px;display:inline-block;width:max-content}
  .mini-desc{display:none;font-size:.78rem;color:var(--muted);line-height:1.35;margin-top:6px}
  .mini-card:hover .mini-desc{display:block}

  /* right column map */
  .map-col{background:var(--panel2);border:1px solid var(--line);border-radius:12px;padding:10px}
  .map-head{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:6px}
  .map-tabs .tab{padding:6px 10px;border-radius:999px}
  .map-wrap{border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#000;display:flex;align-items:center;justify-content:center;min-height:55vh}
  @media(min-width:900px){ .map-wrap{min-height:70vh} }
  .map-wrap img{width:100%;height:100%;object-fit:cover}
  .map-notes{margin-top:8px;display:grid;gap:8px}
  .panel-list{background:var(--panel);border:1px solid var(--line);border-radius:10px;padding:10px}
  .panel-list h3{margin:0 0 6px 0;color:var(--brand2);font-size:1rem}
  .panel-list ul{margin:0;padding-left:18px;line-height:1.45}

  footer{border-top:1px solid var(--line);margin-top:14px;padding:10px 0 24px}
  footer small{color:var(--muted)}

  /* Sticky filters */
  .sticky{position:sticky;top:64px;z-index:5;background:var(--panel2);border-bottom:1px solid var(--line);padding-top:6px}

  /* Collapsibles */
  details.panel-list > summary{cursor:pointer;list-style:none;font-weight:800;color:var(--brand2)}
  details.panel-list[open] > summary{margin-bottom:6px}

  /* Buy Station price table */
  .price-table{width:100%;border-collapse:collapse;font-size:.92rem}
  .price-table th,.price-table td{border:1px solid var(--line);padding:8px 10px}
  .price-table th{background:#141b27;text-align:left;position:sticky;top:0;z-index:1}
  .price-table td:nth-child(2),.price-table td:nth-child(3){text-align:right;white-space:nowrap}
  .price-note{margin-top:6px;color:var(--muted);font-size:.85rem}

  /* BR Systems fixed layout + scroll area for prices */
  .br-col{display:grid;grid-template-rows:auto minmax(120px,22vh) minmax(180px,46vh) minmax(100px,1fr);gap:8px}
  #brPanel{max-height:22vh;overflow:auto}
  #buyPrices{max-height:46vh;overflow:auto}
  .br-notes{max-height:18vh;overflow:auto}
</style>
</head>
<body>
<header>
  <div class="head">
    <img src="https://i.imgur.com/K0TTjUC.png" alt="Logo" class="logo">
    <h1>CODM — Battle Royale Caster Reference</h1>
    <div class="bar">
      <!-- Page buttons go here -->
      <nav id="tabs" class="tabs"></nav>
    </div>
  </div>
</header>

<div class="shell">

  <!-- ===================== PAGE 1: CLASSES ===================== -->
  <section class="block page" data-title="Classes">
    <div class="controls sticky">
      <label class="chip">Category
        <select id="fCat">
          <option value="ALL">All</option>
          <option>Disrupt</option>
          <option>Stealth</option>
          <option>Support</option>
          <option>Defense</option>
          <option>Tracker</option>
        </select>
      </label>
      <label class="chip">Search
        <input id="fSearch" type="text" placeholder="Filter name/keyword…">
      </label>
      <span class="muted" id="metaCount">—</span>
    </div>
    <div id="classGrid" class="grid"></div>
  </section>

  <!-- ===================== PAGE 2: MAPS ===================== -->
  <section class="block page hidden" data-title="Maps">
    <div class="layout">
      <!-- Left: mini cards -->
      <aside class="side">
        <div class="controls sticky">
          <label class="chip">Category
            <select id="mCat">
              <option value="ALL">All</option>
              <option>Disrupt</option>
              <option>Stealth</option>
              <option>Support</option>
              <option>Defense</option>
              <option>Tracker</option>
            </select>
          </label>
          <label class="chip">Search
            <input id="mSearch" type="text" placeholder="Filter…">
          </label>
        </div>
        <div class="mini-meta" id="miniMeta">—</div>
        <div id="miniList" class="mini-list"></div>
      </aside>

      <!-- Right: map -->
      <section class="map-col">
        <div class="map-head">
          <div class="map-tabs tabs" id="mapTabs"></div>
        </div>

        <div class="map-wrap">
          <img id="mapImage" alt="Map View" src="https://i.imgur.com/zhCe95I.png">
        </div>

        <div class="map-notes" id="mapNotes"><!-- filled by JS --></div>
      </section>
    </div>
  </section>

  <!-- ===================== PAGE 3: OTHER DETAILS ===================== -->
  <section class="block page hidden" data-title="Other Details">
    <div class="layout">
      <div class="panel-list">
        <h3>Ammo & Weapons</h3>
        <ul>
          <li><b>Ammo:</b> Light • Heavy • Sniper • Shotgun • Rockets</li>
          <li>Loot rarity: common → rare → epic → legendary</li>
          <li>Airdrops: stronger variants + mod slots</li>
        </ul>
        <h3 style="margin-top:8px">Throwables</h3>
        <ul>
          <li>Frag • Sticky • Molotov • Cluster • Concussion • Flash • Smoke</li>
          <li>Trip Mines & Trophy Systems also appear via loot/classes</li>
        </ul>
      </div>

      <div class="panel-list">
        <h3>Vehicles</h3>
        <ul>
          <li>ATV • Motorcycle • SUV • Cargo Truck • Helicopter • Boat*</li>
          <li>Track heli control; call armor/HP & fuel on rotates</li>
        </ul>
        <h3 style="margin-top:8px">Caster Reminders</h3>
        <ul>
          <li>Watch <b>class synergies</b> (Refitter+Defender; Ninja entries)</li>
          <li>Note <b>revive coin & chip</b> timings / chip stations</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- ===================== PAGE 4: BR SYSTEMS ===================== -->
  <section class="block page hidden" data-title="BR Systems">
    <div class="layout">
      <!-- Left: compact reference -->
      <aside class="side">
        <div class="controls sticky">
          <span class="chip">Quick Reference</span>
        </div>

        <div class="mini-card">
          <img class="mini-thumb" src="https://i.imgur.com/w3xxuAT.jpeg" alt="Buy">
          <div class="mini-txt">
            <div class="mini-name">Buy Stations</div>
            <span class="mini-pill">Isolated (LT)</span>
          </div>
        </div>
        <ul class="mini-meta" style="line-height:1.5;margin:0 0 6px 0;padding-left:16px">
          <li>Loot <b>Cash</b>; spend for perks, streaks, weapons, armor/ammo</li>
        </ul>

        <div class="mini-card">
          <img class="mini-thumb" src="https://i.imgur.com/8S1A7ml.jpeg" alt="Gulag">
          <div class="mini-txt">
            <div class="mini-name">Gulag</div>
            <span class="mini-pill">1v1 • Ticket for extra</span>
          </div>
        </div>
        <ul class="mini-meta" style="line-height:1.5;margin:0 0 6px 0;padding-left:16px">
          <li>First death → Gulag; win redeploys • Teammates can buy tag</li>
        </ul>
      </aside>

      <!-- Right: fixed-height column -->
      <section class="map-col br-col">
        <div class="map-head">
          <div class="tabs">
            <button class="tab" aria-current="page" onclick="setBRPanel('buy')">Buy Station</button>
            <button class="tab" onclick="setBRPanel('gulag')">Gulag</button>
          </div>
        </div>

        <div id="brPanel" class="panel-list"><!-- JS inserts --></div>
        <div id="buyPrices" class="panel-list"><!-- scrollable table --></div>

        <div class="panel-list br-notes">
          <h3>Caster Callouts</h3>
          <ul>
            <li><b>Economy:</b> mention thresholds before late pushes</li>
            <li><b>Shop risk:</b> exposed while buying — watch 3rd parties</li>
          </ul>
        </div>
      </section>
    </div>
  </section>

  <footer class="shell">
    <small>Created by Neptune Garcia</small>
  </footer>
</div>

<script>
  /* ---------- Keyboard shortcuts ---------- */
  document.addEventListener('keydown', (e) => {
    const tag = (e.target.tagName || '').toLowerCase();
    if (tag === 'input' || tag === 'textarea') return;
    if (['1','2','3','4'].includes(e.key)) { go(parseInt(e.key,10)-1); }
    else if (e.key === '/') {
      e.preventDefault();
      const active = [...document.querySelectorAll('.page')].find(p => !p.classList.contains('hidden'));
      const box = active?.querySelector('input[type="text"]');
      if (box) { box.focus(); box.select(); }
    }
  });

  /* ---------- Top pagination (tabs in header) ---------- */
<script>
/* ---------- Page order: MAPS first ---------- */
const PAGE_ORDER = ['Maps', 'Classes', 'BR Systems', 'Other Details'];

// Collect pages by title
const pagesByTitle = {};
document.querySelectorAll('.page').forEach(p => pagesByTitle[p.dataset.title] = p);

// Ordered list that actually exists on the page
const pagesOrdered = PAGE_ORDER.map(t => pagesByTitle[t]).filter(Boolean);

// Build header tabs (next to the title)
const tabs = document.getElementById('tabs');
tabs.innerHTML = '';
pagesOrdered.forEach((sec,i)=>{
  const b = document.createElement('button');
  b.className='tab';
  b.textContent = sec.dataset.title;
  b.addEventListener('click', ()=> go(i));
  tabs.appendChild(b);
});

function showByIndex(idx){
  const clamped = Math.max(0, Math.min(pagesOrdered.length-1, idx));
  pagesOrdered.forEach((p,i)=> p.classList.toggle('hidden', i!==clamped));
  Array.from(tabs.children).forEach((t,i)=> t.setAttribute('aria-current', i===clamped ? 'page' : 'false'));

  const active = pagesOrdered[clamped];
  const title = active.dataset.title;
  sessionStorage.setItem('codm_ref_title', title);

  // When BR Systems is active, ensure panel is hydrated (and prices visible)
  if (title === 'BR Systems') {
    setBRPanel(sessionStorage.getItem('codm_br_panel') || 'buy');
  }

  window.scrollTo({top:0, behavior:'smooth'});
}

// Public go(): accepts index or title
function go(target){
  if (typeof target === 'string') {
    const i = pagesOrdered.findIndex(p => p.dataset.title === target);
    return showByIndex(i >= 0 ? i : 0);
  }
  showByIndex(target|0);
}

// Initial page = saved title or MAPS
const savedTitle = sessionStorage.getItem('codm_ref_title');
go(savedTitle && pagesByTitle[savedTitle] ? savedTitle : 'Maps');

/* ---------- Shortcuts (keep your existing block if you already have it) ---------- */
document.addEventListener('keydown', (e) => {
  const tag = (e.target.tagName || '').toLowerCase();
  if (tag === 'input' || tag === 'textarea') return;
  if (['1','2','3','4'].includes(e.key)) { go(parseInt(e.key,10)-1); } // 1=Maps, 2=Classes, ...
  else if (e.key === '/') {
    e.preventDefault();
    const active = pagesOrdered.find(p => !p.classList.contains('hidden'));
    const box = active?.querySelector('input[type="text"]');
    if (box) { box.focus(); box.select(); }
  }
});
</script>


  /* ---------- Class data ---------- */
  const CLASSES = [
    // DISRUPT
    {name:'Smoke Bomber', cat:'Disrupt', img:'https://i.imgur.com/5Von4HS.jpeg',
      skill:'Cluster Smoke Grenade — generates smoke in a target area that can mark enemies.',
      passive:'After activating skill, movement speed is increased.'},
    {name:'Trap Master', cat:'Disrupt', img:'https://i.imgur.com/Ix22OZX.jpeg',
      skill:'Electric Trip Wire — slows enemies and deals damage to those inside.',
      passive:'After activating skill, movement speed is increased.'},
    {name:'Misdirection', cat:'Disrupt', img:'https://i.imgur.com/mHyxMFJ.jpeg',
      skill:'Misdirection Device — hides the user’s sound and creates fake noise sources.',
      passive:'After activating skill, movement speed is increased.'},
    {name:'Trickster', cat:'Disrupt', img:'https://i.imgur.com/Juck3s7.jpeg',
      skill:'Psychosis — deploy two holographic decoys and gain a strong speed boost.',
      passive:'After activating skill, movement speed is increased.'},
    {name:'Hacker', cat:'Disrupt', img:'https://i.imgur.com/ambedR9.jpeg',
      skill:'Ice Pick — disrupts enemy minimaps and blocks gadget use nearby.',
      passive:'Immune to Hacker; speed increases after activation.'},
    {name:'Rewind', cat:'Disrupt', img:'https://i.imgur.com/FHZ6CLB.jpeg',
      skill:'Glitch — teleport back to your position from 6 seconds prior.',
      passive:'After activating skill, movement speed is increased.'},
    {name:'Shock Wave', cat:'Disrupt', img:'https://i.imgur.com/TzrZLou.jpeg',
      skill:'Shock Wave — pushes & damages hostiles; briefly blocks incoming projectiles.',
      passive:'After activating skill, movement speed is increased.'},

    // STEALTH
    {name:'Ninja', cat:'Stealth', img:'https://i.imgur.com/vaEUwwT.jpeg',
      skill:'Grapple Hook — pull yourself to the target for fast entries.',
      passive:'Reduces movement noises.'},
    {name:'Poltergeist', cat:'Stealth', img:'https://i.imgur.com/ZkEbHl8.jpeg',
      skill:'Active Camo — near-invisibility for a short duration.',
      passive:'Reduces movement noises.'},
    {name:'Pumped', cat:'Stealth', img:'https://i.imgur.com/v2JPRnv.jpeg',
      skill:'Power Jump — enhanced jumping and extra nitrogen after activation.',
      passive:'Reduces movement noises.'},
    {name:'Quick Strike', cat:'Stealth', img:'https://i.imgur.com/gstrWOn.jpeg',
      skill:'Quick Strike — block front bullets then slash to damage enemies.',
      passive:'Reduces movement noises.'},
    {name:'Jet Boost', cat:'Stealth', img:'https://i.imgur.com/07c8Hol.jpeg',
      skill:'Jet Boost — wall run, jet-jump, and jet-slide while active.',
      passive:'Reduces movement noises.'},
    {name:'Teleporter', cat:'Stealth', img:'https://i.imgur.com/EbrxsOE.jpeg',
      skill:'Teleporter Beacon — multiple teleports; entering combat interrupts.',
      passive:'Reduces movement noises.'},
    {name:'Tactical Bouncer', cat:'Stealth', img:'https://i.imgur.com/0NlWFbq.jpeg',
      skill:'Bouncer Platform — catapults players, vehicles & throwables upward.',
      passive:'Reduces movement noises.'},

    // SUPPORT
    {name:'Medic', cat:'Support', img:'https://i.imgur.com/DmHFyUj.jpeg',
      skill:'Medical Station — heals you and allies continuously.',
      passive:'Reduces recovery time.'},
    {name:'Refitter', cat:'Support', img:'https://i.imgur.com/7Cgp0VH.jpeg',
      skill:'Armor Pack — drop repair packs for the team. Auto-repairs the vehicle you ride.',
      passive:'Reduces recovery time.'},
    {name:'Kinetic Station', cat:'Support', img:'https://i.imgur.com/cYlgKyf.jpeg',
      skill:'Kinetic Station — deploy for limited-time armor to reduce bullet damage.',
      passive:'Reduces recovery time.'},
    {name:'Revive', cat:'Support', img:'https://i.imgur.com/bCD2vk4.jpeg',
      skill:'Revive Drone — searches for and revives teammates automatically.',
      passive:'Reduces recovery time.'},

    // DEFENSE
    {name:'Defender', cat:'Defense', img:'https://i.imgur.com/78iMmlU.jpeg',
      skill:'Transform Shield — deploy cover that flashbangs nearby hostiles.',
      passive:'Reduces explosive damage and negative statuses.'},
    {name:'Desperado', cat:'Defense', img:'https://i.imgur.com/8hTuwnZ.jpeg',
      skill:'Shield Turret — place a shielded turret. When downed, fight with pistol; kills revive you.',
      passive:'Reduces explosive damage and negative statuses.'},
    {name:'Spotter', cat:'Defense', img:'https://i.imgur.com/EbF3a3R.jpeg',
      skill:'Cluster Strike — call an air strike on a designated area.',
      passive:'Reduces explosive damage and negative statuses.'},
    {name:'Igniter', cat:'Defense', img:'https://i.imgur.com/JcRNvAM.jpeg',
      skill:'Tinder Bag — continuously spews tar to control space.',
      passive:'Reduces explosive damage and negative statuses.'},

    // TRACKER
    {name:'Scout', cat:'Tracker', img:'https://i.imgur.com/3i9SxOc.jpeg',
      skill:'Sensor Dart — reveals hostiles on radar.',
      passive:'Enemy footprints visible; footsteps audible from distance.'},
    {name:'Clown', cat:'Tracker', img:'https://i.imgur.com/abSMexk.jpeg',
      skill:'Toy Bomb — summon dogs that attack nearby enemies.',
      passive:'Enemy footsteps can be heard from a distance.'},
    {name:'Mechanic', cat:'Tracker', img:'https://i.imgur.com/CrlOFGM.jpeg',
      skill:'EMP Drone — interferes with hostiles.',
      passive:'Detect vehicles through walls; footsteps audible from distance.'},
    {name:'Airborne', cat:'Tracker', img:'https://i.imgur.com/ElXS8sq.jpeg',
      skill:'Ejection Device — catapult team into the air, trigger wingsuit.',
      passive:'Gliding lasts longer; footsteps audible from distance.'},
    {name:'Ravager Launcher', cat:'Tracker', img:'https://i.imgur.com/5FUvd6c.jpeg',
      skill:'Ravager Launcher — locks onto enemy soldiers & vehicles automatically.',
      passive:'Enemy footsteps can be heard from a distance.'}
  ];

  // --- Buy Station prices (Normal & Fire Sale = 30% off) ---
  // --- Buy Station prices (explicit normal + fire sale) ---
const BUY_PRICES = [
  { item: "Ammunition (per type)", normal: 1000, sale: 700 }, // Heavy, Sniper, Light, Shotgun, Rockets
  { item: "Ballistic Expert",      normal: 4000, sale: 2800 },
  { item: "Backpack Lv. 2",        normal: 5000, sale: 3500 },
  { item: "Backpack Lv. 3",        normal: 12000, sale: 8400 },
  { item: "C4",                    normal: 3000, sale: 2100 },
  { item: "Class Chip Upgrade",    normal: 5000, sale: 3500 },
  { item: "Kinetic Armor",         normal: 5000, sale: 3500 },
  { item: "Legendary Mods",        normal: 7000, sale: 4900 },
  { item: "Loadout Drop",          normal: 50000, sale: 35000 },
  { item: "Mini Loadout Drop",     normal: 20000, sale: 14000 },
  { item: "Mythic Weapon",         normal: 12000, sale: 8400 },
  { item: "RC-XD",                 normal: 8000, sale: 5600 },
  { item: "Revival Coin",          normal: 15000, sale: 10500 },
  { item: "Self-Revive Kit",       normal: 6000, sale: 4200 },
  { item: "Stealth Chopper",       normal: 15000, sale: 10500 },
  { item: "Strafe Run",            normal: 8000, sale: 5600 },
  { item: "Trophy System",         normal: 3000, sale: 2100 },
];

  const fmt = n => n>=1000 ? ((n%1000===0? (n/1000): (n/1000).toFixed(1)) + "K") : String(n);

  function renderBuyPrices(){
    const host = document.getElementById('buyPrices');
    if(!host) return;
    const rows = BUY_PRICES.map(r=>`
      <tr>
        <td>${r.item}</td>
        <td>C ${fmt(r.normal)}</td>
        <td>C ${fmt(r.sale ?? Math.round(r.normal * 0.7))}</td>
      </tr>`).join('');
    host.innerHTML = `
      <details class="panel-list" open>
        <summary>Buy Station Prices</summary>
        <table class="price-table">
          <thead>
            <tr><th>Item</th><th>Normal</th><th>Fire&nbsp;Sale</th></tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
        <div class="price-note">
          Fire Sale reduces all prices by 30%.
          <br/><i>Note:</i> “Ammunition (per type)” covers Heavy, Sniper, Light, Shotgun, and Rockets.
        </div>
      </details>
    `;
  }


  // BR Systems content
  const BR_INFO = {
    buy: {
      title: "Buy Station — Flow",
      points: [
        "<b>Cash:</b> loot & eliminations; drops on death",
        "<b>Spend:</b> perks, streaks, weapons, armor/ammo, specials",
        "<b>Timing:</b> buy fast — exposed to third parties"
      ],
      tips: [
        "Call team cash before pushes",
        "Flag high-value buys (Loadout, Revive, Chopper)"
      ]
    },
    gulag: {
      title: "Gulag — Flow",
      points: [
        "First death → <b>1v1</b> Gulag",
        "<b>Win:</b> redeploy • <b>Lose:</b> teammates can buy your tag",
        "Extra tries via <b>Gulag Ticket</b> (Buy Station)"
      ],
      tips: [
        "Track who has free attempt vs. ticket",
        "Note staggered redeploys if multiple queued"
      ]
    }
  };

  function setBRPanel(which){
    const data = BR_INFO[which] || BR_INFO.buy;
    const box = document.getElementById('brPanel');
    box.innerHTML = `
      <h3>${data.title}</h3>
      <ul>${data.points.map(p=>`<li>${p}</li>`).join('')}</ul>
      <h3 style="margin-top:8px">Desk Tips</h3>
      <ul>${data.tips.map(p=>`<li>${p}</li>`).join('')}</ul>
    `;
    const btns = box.parentElement.querySelectorAll('.tabs .tab');
    btns.forEach(b=>b.setAttribute('aria-current', b.textContent.toLowerCase().includes(which) ? 'page':'false'));
    sessionStorage.setItem('codm_br_panel', which);

    const pricesPanel = document.getElementById('buyPrices');
    pricesPanel.style.display = (which==='buy') ? 'block' : 'none';
    if(which==='buy') renderBuyPrices();
  }

  // init default panel on load of this page
  (function(){
    const saved = sessionStorage.getItem('codm_br_panel') || 'buy';
    if (document.querySelector('[data-title="BR Systems"]') && !document.querySelector('[data-title="BR Systems"]').classList.contains('hidden')) {
      setBRPanel(saved);
    }
    // Hook into tab navigation so BR Systems renders when opened
    const origGo = window.go;
    window.go = function(n){
      origGo(n);
      const pages = Array.from(document.querySelectorAll('.page'));
      const idx = Math.max(0, Math.min(pages.length-1, n));
      if (pages[idx].dataset.title === 'BR Systems') setBRPanel(sessionStorage.getItem('codm_br_panel') || 'buy');
    };
  })();

  /* ---------- Classes page rendering ---------- */
  const grid = document.getElementById('classGrid');
  const fCat = document.getElementById('fCat');
  const fSearch = document.getElementById('fSearch');
  const meta = document.getElementById('metaCount');

  function renderClasses(){
    const cat = fCat.value || 'ALL';
    const q = (fSearch?.value||'').trim().toLowerCase();
    const rows = CLASSES.filter(c =>
      (cat==='ALL' || c.cat===cat) &&
      (!q || (c.name.toLowerCase().includes(q) || c.cat.toLowerCase().includes(q) ||
              c.skill.toLowerCase().includes(q) || (c.passive||'').toLowerCase().includes(q)))
    );
    grid.innerHTML = '';
    rows.forEach(c=>{
      const card = document.createElement('article');
      card.className = 'class-card';
      card.innerHTML = `
        <img src="${c.img}" alt="${c.name}">
        <div class="class-info">
          <div class="title-row">
            <h3>${c.name}</h3>
            <span class="pill">${c.cat}</span>
          </div>
          <div class="kv"><b>Skill:</b> ${c.skill}</div>
          ${c.passive ? `<div class="kv"><b>Passive:</b> ${c.passive}</div>`:''}
        </div>`;
      grid.appendChild(card);
    });
    meta.textContent = `${rows.length} / ${CLASSES.length}`;
  }
  fCat.addEventListener('change', renderClasses);
  fSearch.addEventListener('input', renderClasses);

  /* ---------- Maps page: mini list + big map ---------- */
  const miniList = document.getElementById('miniList');
  const mCat = document.getElementById('mCat');
  const mSearch = document.getElementById('mSearch');
  const miniMeta = document.getElementById('miniMeta');

  function renderMini(){
    const cat = mCat.value || 'ALL';
    const q = (mSearch?.value||'').trim().toLowerCase();
    const rows = CLASSES.filter(c =>
      (cat==='ALL' || c.cat===cat) &&
      (!q || c.name.toLowerCase().includes(q) ||
             c.cat.toLowerCase().includes(q) ||
             c.skill.toLowerCase().includes(q) ||
            (c.passive||'').toLowerCase().includes(q))
    );

    miniList.innerHTML = '';
    rows.forEach(c=>{
      const li = document.createElement('div');
      li.className = 'mini-card';
      li.innerHTML = `
        <img class="mini-thumb" src="${c.img}" alt="${c.name}">
        <div class="mini-txt" style="min-width:0">
          <div class="mini-name">${c.name}</div>
          <span class="mini-pill">${c.cat}</span>
          <div class="mini-desc">
            <b>Skill:</b> ${c.skill}
            ${c.passive ? `<br><b>Passive:</b> ${c.passive}` : ''}
          </div>
        </div>`;
      miniList.appendChild(li);
    });

    miniMeta.textContent = `${rows.length} classes`;
  }

  mCat.addEventListener('change', renderMini);
  mSearch.addEventListener('input', renderMini);

  /* ---------- Map viewer ---------- */
  const MAPS = {
    Isolated: {
      img: 'https://i.imgur.com/zhCe95I.png',
      notes: [
        {title:'Isolated — POIs', items:[
          'Bus Station • Killhouse • Standoff • Sakura • Estate',
          'Pipeline • Nuclear Plant • Launch Base • Crash',
          'Downtown • Harbor • Countdown • Black Market',
          'Farm • Sanitarium • Dock • Heat • Outpost',
          'High-Tier Zones rotate each match (gold beacons).'
        ]},
        {title:'Caster Notes', items:[
          '<b>North rotations:</b> Pipeline → Nuclear Plant → Launch Base ridge.',
          '<b>Hot early drops:</b> Black Market, Launch Base, Nuketown Shipyard Dock.',
          '<b>Vehicle paths:</b> ring roads around Sakura & Nuclear Plant for quick wraps.'
        ]}
      ]
    },
    Blackout: {
      img: 'https://i.imgur.com/XzkG6cV.png',
      notes: [
        {title:'Blackout — POIs', items:[
          'Estates • Construction Site • Asylum • Array • Hydro Dam',
          'Fracking Tower • Train Station • Rivertown • Factory',
          'Cargo Docks • Lighthouse • Nuketown Island • Turbine'
        ]},
        {title:'Caster Notes', items:[
          '<b>Long rotates:</b> Lighthouse ↔ Cargo Docks shore road, watch third parties.',
          '<b>Top control:</b> Construction Site cranes, Fracking tower decks.',
          '<b>Bridge fights:</b> Rivertown & Nuketown causeway — call team splits early.'
        ]}
      ]
    }
  };

  const mapTabs = document.getElementById('mapTabs');
  const mapImage = document.getElementById('mapImage');
  const mapNotes = document.getElementById('mapNotes');

  ['Isolated','Blackout'].forEach((name,i)=>{
    const b = document.createElement('button');
    b.className = 'tab';
    b.textContent = name;
    b.addEventListener('click', ()=> setMap(name));
    if(i===0) b.setAttribute('aria-current','page');
    mapTabs.appendChild(b);
  });

  function setMap(name){
    const data = MAPS[name];
    if(!data) return;
    mapImage.src = data.img;
    Array.from(mapTabs.children).forEach(btn=>{
      btn.setAttribute('aria-current', btn.textContent===name ? 'page' : 'false');
    });
    // notes (collapsible)
    mapNotes.innerHTML = '';
    data.notes.forEach(n=>{
      const wrap = document.createElement('details');
      wrap.className = 'panel-list';
      if (!/Caster Notes/i.test(n.title)) wrap.open = true;
      wrap.innerHTML = `<summary>${n.title}</summary>`;
      const ul = document.createElement('ul');
      n.items.forEach(item=>{
        const li = document.createElement('li');
        li.innerHTML = item;
        ul.appendChild(li);
      });
      wrap.appendChild(ul);
      mapNotes.appendChild(wrap);
    });
    sessionStorage.setItem('codm_map', name);
  }

  // init tab + views
  const last = parseInt(sessionStorage.getItem('codm_ref_tab')||'0',10);
  go(isFinite(last)? last : 0);
  renderClasses();
  renderMini();
  const lastMap = sessionStorage.getItem('codm_map') || 'Isolated';
  setMap(lastMap);
</script>
</body>
</html>
